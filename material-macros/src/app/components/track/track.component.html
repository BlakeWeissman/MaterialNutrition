<mat-sidenav-container *ngIf="userService.user">
  <mat-sidenav mode="side" opened>
    <nav>
      <div style="display: flex; align-items: center;">
        <button mat-icon-button [matMenuTriggerFor]="navigationCalendar">
          <mat-icon>
            today   
          </mat-icon>
        </button>
        <h3 style="margin: 0 !important;">
          {{selectedDate | date: 'M/d/yyyy'}}
        </h3>
      </div>
      <div>
        <button mat-icon-button (click)="navigateToDate(selectedDate.setDate(selectedDate.getDate() - 1))">
          <mat-icon>
            keyboard_arrow_left
          </mat-icon>
        </button>
        <button mat-icon-button (click)="navigateToDate(selectedDate.setDate(selectedDate.getDate() + 1))">
          <mat-icon>
            keyboard_arrow_right
          </mat-icon>
        </button>
      </div>
    </nav>
    <div id="info">
      <mat-divider>
      </mat-divider>
      <div id="menu">
        <div>
          <h2>
            {{totalNutritionData[NutritionDataKeys.CALORIES]}}/{{userService.user.goals[NutritionDataKeys.CALORIES]}} Calories
          </h2>
          <mat-progress-bar mode="determinate" [value]="totalNutritionData[NutritionDataKeys.CALORIES]/userService.user.goals[NutritionDataKeys.CALORIES] * 100">
          </mat-progress-bar>
          <div id="macros">
            <div *ngFor="let macroKey of macroKeys">
              <h4>
                {{macroKey | titlecase}}:
              </h4>
              <mat-progress-bar mode="determinate" [value]="totalNutritionData[macroKey]/userService.user.goals[macroKey] * 100">
              </mat-progress-bar>
              <h4>
                {{totalNutritionData[macroKey]}}/{{userService.user.goals[macroKey]}}g
              </h4>
            </div>
          </div>
          <mat-chip-list class="mat-chip-list-stacked">
            <mat-chip routerLink="goals">
              <mat-icon>
                bar_chart
              </mat-icon>
              Edit goals
            </mat-chip>
            <mat-chip routerLink="items">
              <mat-icon>
                edit
              </mat-icon>
              Edit items
            </mat-chip>
          </mat-chip-list>
        </div>
        <span class="mat-caption">
          v1.0 Dev
          <br>
          &copy;{{currentDate | date: 'yyyy'}} 
          <a href="https://blakeweissman.com" target="_blank">
            Blake Weissman
          </a>
        </span>
      </div>
    </div>
  </mat-sidenav>
  <mat-sidenav-content>
    <router-outlet>
    </router-outlet>
    <button mat-fab color="primary" routerLink="add">
      <mat-icon>
        add
      </mat-icon>
    </button>
    <table mat-table [dataSource]="dataSource" style="width: 100%;">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> 
          Name
        </th>
        <td mat-cell *matCellDef="let userLogItem"> 
          {{userLogItem.name}}
        </td>
      </ng-container>
      <ng-container [matColumnDef]="key" *ngFor="let key of nutritionDataKeysWithAmountKey">
        <th mat-header-cell *matHeaderCellDef> 
          {{key | titlecase}} 
        </th>
        <td mat-cell *matCellDef="let userLogItem"> 
          {{userLogItem[key == 'amount' ? 'amountPerServing' : key] * userLogItem.servings}} {{key == 'amount' ? userLogItem.servingUnit : ''}}
        </td>
      </ng-container>
      <ng-container matColumnDef="servings">
        <th mat-header-cell *matHeaderCellDef> 
          Servings
        </th>
        <td mat-cell *matCellDef="let userLogItem"> 
          <mat-form-field>
            <input matInput [ngModel]="userLogItem.servings" [pattern]="positiveIntegersRegex" (ngModelChange)="userLogItem.servings = servings.valid ? $event : userLogItem.servings" #servings="ngModel" (blur)="saveLogItem(userLogItem)" (keyup.enter)="$event.target.blur()">
          </mat-form-field>
        </td>
      </ng-container>
      <ng-container matColumnDef="remove">
        <th mat-header-cell *matHeaderCellDef> 
        </th>
        <td mat-cell *matCellDef="let index = index;"> 
          <button mat-icon-button color="warn" (click)="removeLogItem(index)">
            <mat-icon>
              delete
            </mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <!-- {{userService.user.log[userService.selectedEpoch][0].items | json}} -->
    <!-- <table mat-table [dataSource]="userService.user.log[userService.selectedEpoch]">
    </table>     -->

    <!-- <cdk-virtual-scroll-viewport itemSize="50">
      <div cdkDropList (cdkDropListDropped)="drop($event)">
        <!--
          TODO: In the future users will be able to catagorize foods into custom 
          meals. For now users can only store foods into the "Other" meal, which 
          just displays the list of foods without nesting them.
        <ng-container *cdkVirtualFor="let meal of userService.user.log[userService.selectedEpoch]">
          <ng-container *ngFor='let logItem of meal.items'>
            <mat-expansion-panel *ngIf="userService.user.items[logItem.key]; let userItem" [expanded]="true" hideToggle>
              <mat-expansion-panel-header>
                <h2>
                  {{userItem.label}}
                </h2>
                <mat-icon>
                  drag_handle
                </mat-icon>
              </mat-expansion-panel-header>
              <app-log-item-stats [logItem]="logItem" [userItem]="userItem">
              </app-log-item-stats>
              <button mat-stroked-button color="warn">Remove</button>
            </mat-expansion-panel>
          </ng-container>
        </ng-container>
      </div>
    </cdk-virtual-scroll-viewport> -->
  </mat-sidenav-content>
</mat-sidenav-container>
<mat-menu #navigationCalendar="matMenu">
  <div (click)="$event.stopPropagation();">
    <mat-calendar [selected]="selectedDate" (selectedChange)="onDateSelect($event)">
    </mat-calendar>  
  </div>
</mat-menu>